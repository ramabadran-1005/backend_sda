#!/bin/bash

echo "ðŸ”¥ Cleaning backend folderâ€¦"

# 1. Remove node_modules
echo "ðŸ—‘ Removing node_modulesâ€¦"
rm -rf node_modules

# 2. Remove all .zip files
echo "ðŸ—‘ Removing all ZIP filesâ€¦"
find . -name "*.zip" -type f -delete

# 3. Remove unwanted folders
echo "ðŸ—‘ Removing heavy foldersâ€¦"
rm -rf ml
rm -rf iot_dashboard_app*
rm -rf Nwarehouse-Dashboard-master*
rm -rf nwh-webpage-master*
rm -rf node_modules.zip
rm -rf models.zip
rm -rf src.zip
rm -rf utils.zip
rm -rf controllers.zip
rm -rf routes.zip
rm -rf config.zip

# 4. Create proper .gitignore
echo "ðŸ“ Creating .gitignoreâ€¦"
cat > .gitignore <<EOF
node_modules/
*.zip
.env
*.log
__pycache__/
EOF

# 5. Reset last commit
echo "ðŸ”„ Removing previously staged large filesâ€¦"
git reset --hard

# 6. Stage only backend files
echo "ðŸ“¦ Staging clean backend filesâ€¦"
git add server.js package.json package-lock.json
git add api routes models config middleware utils

# 7. Commit clean backend
echo "ðŸ“ Committing clean backendâ€¦"
git commit -m "clean backend for render deployment"

echo "ðŸš€ Now push using: git push -u origin main"
echo "âœ” Cleanup complete!"
